"0","#https://en.wikipedia.org/wiki/Negative_binomial_distribution#Gamma%E2%80%93Poisson_mixture"
"0","#use optim to optimise for r and m"
"0","#r is a shape parameter so it doesnt really affect the loglikelihood much"
"0","# we want mean = variance i think... therefore you can solve for r = m^2 /(sample variance  - m)"
"0","#This is done by looking at birgit's notes and seeing that variance = m + m^2/r"
"0","calc_negbinom_loglik <- function(par){"
"0","  m <- par[1]"
"0","  r <- m^2 /(var(x)-m)"
"0","  "
"0","  loglik <- -n*log(gamma(r)) + sum(log(gamma(r+x))) - sum(log(factorial(x))) + sum(x) * log(m/(m+r)) + n*r*log(r/(r+m))"
"0","  "
"0","  return(loglik)"
"0","  "
"0","}"
"0","#If we maximise loglikelihood, we will be minimising AIC"
"0","mle_negbinom <-"
"0","  optim("
"0","  par = 1,"
"0","  fn = calc_negbinom_loglik ,"
"0","  control = list(fnscale = -1),"
"0","  lower = 3,"
"0","  upper = 30 ,"
"0","  method = ""L-BFGS-B"","
"0","  hessian = T"
"0","  )"
"0","m_estimate <- round(mle_negbinom$par[1],4)"
"0","r_estimate <- round(m_estimate^2 /(var(x)-m_estimate),4)"
"0","aic_negbinom <- round(-2*mle_negbinom$value + 2*(2),2)"
"0","bic_negbinom <- round(-2*mle_negbinom$value + log(n),2)"
"0","data_frame(`Mean $\\hat{m}$`= m_estimate , `Shape $\\hat{r}$` = r_estimate, AIC = aic_negbinom, BIC = bic_negbinom) %>% knitr::kable(caption = ""Negative Binomial MLE's & information metrics"")"
"1","

"
"1","| Mean $\hat{m}$| Shape $\hat{r}$|     AIC|     BIC|"
"1","
"
"1","|--------------:|---------------:|-------:|-------:|"
"1","
"
"1","|         6.8108|          0.5926| 9626.92| 9630.31|"
"1","
"
