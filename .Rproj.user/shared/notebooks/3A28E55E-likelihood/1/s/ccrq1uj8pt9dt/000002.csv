"0","#https://en.wikipedia.org/wiki/Negative_binomial_distribution#Gamma%E2%80%93Poisson_mixture"
"0","#use optim to optimise for r and m"
"0","#r is a shape parameter so it doesnt really affect the loglikelihood much"
"0","# we want mean = variance i think... therefore you can solve for r = m^2 /(sample variance  - m)"
"0","#This is done by looking at birgit's notes and seeing that variance = m + m^2/r"
"0","calc_negbinom_loglik <- function(par){"
"0","  m <- par[1]"
"0","  r <- m^2 /(var(x)-m)"
"0","  "
"0","  loglik <- -n*log(gamma(r)) + sum(log(gamma(r+x))) - sum(log(factorial(x))) + sum(x) * log(m/(m+r)) + n*r*log(r/(r+m))"
"0","  "
"0","  return(loglik)"
"0","  "
"0","}"
"0","#If we maximise loglikelihood, we will be minimising AIC"
"0","mle_negbinom <-"
"0","  optim("
"0","  par = 1,"
"0","  fn = calc_negbinom_loglik ,"
"0","  control = list(fnscale = -1),"
"0","  lower = 3,"
"0","  upper = 30 ,"
"0","  method = ""L-BFGS-B"""
"0","  )"
"0","m_estimate <- mle_negbinom$par[1]"
"0","r_estimate <- m_estimate^2 /(var(x)-m_estimate)"
"0","aic_negbinom <- -2*mle_negbinom$value + 2*(2)"
"0","data_frame(`M Mean Estimate`= m_estimate , `r Shape Estimate` = r_estimate, AIC = aic_negbinom) %>% knitr::kable()"
"1","

"
"1","| M Mean Estimate| r Shape Estimate|      AIC|"
"1","
"
"1","|---------------:|----------------:|--------:|"
"1","
"
"1","|        6.810803|         0.592616| 9626.917|"
"1","
"
