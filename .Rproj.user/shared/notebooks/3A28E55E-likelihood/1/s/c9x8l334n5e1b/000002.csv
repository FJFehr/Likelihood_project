"0","#need to calulcate mle at EACH point"
"0","m_range <- seq(1,56, by = 0.1) #values of m for profile m loglikelihood"
"0","r_range <- seq(0.01,0.8 , by = 0.01)"
"0","calc_negbinom_loglik_profile <- function(r,m){"
"0","  "
"0","  loglik <- -n*log(gamma(r)) + sum(log(gamma(r+x))) - sum(log(factorial(x))) + sum(x) * log(m/(m+r)) + n*r*log(r/(r+m))"
"0","  "
"0","  return(loglik)"
"0","  "
"0","}"
"0","profile_likelihood_calc_mean <- function(){"
"0","  "
"0","  #Calculate profile for M by calculating mle for R at eacg value of M"
"0","  "
"0","  estimated_r_s <- numeric(length(m_range))"
"0","  "
"0","          for(i in seq_along(m_range)){"
"0","            "
"0","              mle_profile <- #find mle for r at each value of m"
"0","                          optim("
"0","                          par = 1,"
"0","                          m = m_range[i],"
"0","                          fn = calc_negbinom_loglik_profile ,"
"0","                          control = list(fnscale = -1),"
"0","                          lower = 0.1,"
"0","                          upper = 30 ,  # i presume shape cant take a ridiculous value like this"
"0","                          method = ""L-BFGS-B"""
"0","          )"
"0","          estimated_r_s[i] <- mle_profile$par"
"0","            "
"0","        }"
"0","          "
"0","  return(estimated_r_s)"
"0","}"
"0","estimated_r_values <- profile_likelihood_calc_mean()"
"0","#For each r in estimated_r_values, sub in M from 1:56 and trace it "
"0","m_profile_loglik_values <- numeric(length(m_range))"
"0","for (i in seq_along(estimated_r_values)){"
"0","  "
"0","  m_profile_loglik_values[i] <- calc_negbinom_loglik_profile(r = estimated_r_values[i], m = m_range[i])"
"0","  "
"0","  "
"0","}"
"0","data_frame(x = m_range, val = m_profile_loglik_values) %>% "
"0","    ggplot(aes(x=x,y=val))+"
"0","    geom_point(size = 1) +"
"0","   scale_x_continuous(breaks = seq(0,56,by=2)) +"
"0","    geom_vline(xintercept = 6.9, col = ""red"", lty = ""dashed"") +"
"0","    labs(x = ""M parameter value"", y = ""Profile Loglikelihood"" , title = ""Profile Loglikelihood of M Parameter"") +"
"0","    theme_classic()"
